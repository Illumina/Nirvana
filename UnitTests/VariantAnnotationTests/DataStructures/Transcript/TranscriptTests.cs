using UnitTests.Utilities;
using VariantAnnotation.Algorithms;
using Xunit;

namespace UnitTests.VariantAnnotationTests.DataStructures.Transcript
{
    public class TranscriptTests
    {
        [Fact]
        public void AlternateCdsForward()
        {
            const string expectedAlternateCds = "ATGGAGCAGGATCCCAAGCCGCCCCGTCTGCGGCTCTGGGCCCTGATCCCCTGGCTTCCCAGGAAGCAGCGGCCCAGGATCAGCCAGACCTCTCTGCCTGTCCCTGGCCCTGGCTCTGGCCCCCAGCGGGACTCGGATGAGGGCGTCCTCAAGGAGATCTCCATCACGCACCACGTCAAGGCTGGCTCTGAGAAGGCTGATCCATCCCATTTCGAGCTCCTCAAGGTTCTGGGCCAGGGATCCTTTGGCAAAGTCTTCCTGGTGCGGAAAGTCACCCGGCCTGACAGTGGGCACCTGTATGCTATGAAGGTGCTGAAGAAGGCAACGCTGAAAGTACGTGACCGCGTCCGGACCAAGATGGAGAGAGACATCCTGGCTGATGTAAATCACCCATTCGTGGTGAAGCTGCACTATGCCTTCCAGACCGAGGGCAAGCTCTATCTCATTCTGGACTTCCTGCGTGGTGGGGACCTCTTCACCCGGCTCTCAAAAGAGGTAATATACATGATTCAAAAGAAAAATATTCATGAAGAAGTCTTCCTCCCACCCCAGCCCCCTCTATTCCCATCTATAGGTGATGTTCACGGAGGAGGATGTGAAGTTTTACCTGGCCGAGCTGGCTCTGGGCCTGGATCACCTGCACAGCCTGGGTATCATTTACAGAGACCTCAAGCCTGAGAACATCCTTCTGGATGAGGAGGGCCACATCAAACTCACTGACTTTGGCCTGAGCAAAGAGGCCATTGACCACGAGAAGAAGGCCTATTCTTTCTGCGGGACAGTGGAGTACATGGCCCCTGAGGTCGTCAACCGCCAGGGCCACTCCCATAGTGCGGACTGGTGGTCCTATGGGGTGTTGATGTTTGAGATGCTGACGGGCTCCCTGCCCTTCCAGGGGAAGGACCGGAAGGAGACCATGACACTGATTCTGAAGGCGAAGCTAGGCATGCCCCAGTTTCTGAGCACTGAAGCCCAGAGCCTCTTGCGGGCCCTGTTCAAGCGGAATCCTGCCAACCGGCTCGGCTCCGGCCCTGATGGGGCAGAGGAAATCAAGCGGCATGTCTTCTACTCCACCATTGACTGGAATAAGCTATACCGTCGTGAGATCAAGCCACCCTTCAAGCCAGCAGTGGCTCAGCCTGATGACACCTTCTACTTTGACACCGAGTTCACGTCCCGCACACCCAAGGATTCCCCAGGCATCCCCCCCAGCGCTGGGGCCCATCAGCTGTTCCGGGGCTTCAGCTTCGTGGCCACCGGCCTGATGGAAGACGACGGCAAGCCTCGTGCCCCGCAGGCACCCCTGCACTCGGTGGTACAGCAACTCCATGGGAAGAACCTGGTTTTTAGTGACGGCTACGTGGTAAAGGAGACAATTGGTGTGGGCTCCTACTCTGAGTGCAAGCGCTGTGTCCACAAGGCCACCAACATGGAGTATGCTGTCAAGGTCATTGATAAGAGCAAGCGGGATCCTTCAGAAGAGATTGAGATTCTTCTGCGGTATGGCCAGCACCCCAACATCATCACTCTGAAAGATGTGTATGATGATGGCAAACACGTGTACCTGGTGACAGAGCTGATGCGGGGTGGGGAGCTGCTGGACAAGATCCTGCGGCAGAAGTTCTTCTCAGAGCGGGAGGCCAGCTTTGTCCTGCACACCATTGGCAAAACTGTGGAGTATCTGCACTCACAGGGGGTTGTGCACAGGGACCTGAAGCCCAGCAACATCCTGTATGTGGACGAGTCCGGGAATCCCGAGTGCCTGCGCATCTGTGACTTTGGTTTTGCCAAACAGCTGCGGGCTGAGAATGGGCTCCTCATGACACCTTGCTACACAGCCAACTTTGTGGCGCCTGAGGTGCTGAAGCGCCAGGGCTACGATGAAGGCTGCGACATCTGGAGCCTGGGCATTCTGCTGTACACCATGCTGGCAGGATATACTCCATTTGCCAACGGTCCCAGTGACACACCAGAGGAAATCCTAACCCGGATCGGCAGTGGGAAGTTTACCCTCAGTGGGGGAAATTGGAACACAGTTTCAGAGACAGCCAAGGACCTGGTGTCCAAGATGCTACACGTGGATCCCCACCAGCGCCTCACAGCTAAGCAGGTTCTGCAGCATCCATGGGTCACCCAGAAAGACAAGCTTCCCCAAAGCCAGCTGTCCCACCAGGACCTACAGCTTGTGAAGGGAGCCATGGCTGCCACGTACTCCGCACTCAACAGCTCCAAGCCCACCCCCCAGCTGAAGCCCATCGAGTCATCCATCCTGGCCCAGCGGCGAGTGAGGAAGTTGCCATCCACCACCCTGTGAGGCACCAGGGCATTCGGGCCACAGGGCGGTGCTAGCTTGACACAGTCAGCATGCTTCCCAGAGGGAGCAGGCCGGAACCACAGGGCCAGAGGGAGCTGGAACCCGAGGGGCCGGGGAAGCTGCCAGCCCAGAACACCCCTAATGAGGGTGTGAGAAGTGCCTTCTCCTTCCCCAGGATGGACTCTTCTCGGCTCAGGCTCTGCTGGTGGAAAGCGATTCACTGTATAAACTTTTTTTTATGAAAAAAATGGCATCAACCACCATGGATTTTTACAAGATCCATTTGCCTTTCTGGGAGCAGAAACAGCCATTGCGGCCCCAGGAGGGGAACTGAGTCACGCTGGGGCTCTCTGAGACTCTTTAGAGCAGCTTTGGGATCCCACCCTGGGGACCCCCACGATTGGCCACCTGTAGCCATCTGCACACACCTCCGAGACAGTCCAGTGTCACCTCTCTCAGAGCATCTGGCTGTTTAGCAGAACTCATTCTATCCCCAATCAGCTCCTTTTCCGTTCTGTTCTGCTGGGAGTTCTAGAACCACTTCCTGCTACAGGAGGGGTCTCATGTCCTGCTGGCTTCCAGCTTCAGGCACCAGCATCCACCTTGGCTCTGCCAGTGGATCCCCTGCGGTCAGGCTGGGCAGCCCCAGAGAGAGGATGTGGAAAGCACTTTTTGGCTGACTTCATCTGGGGTTGGCAACAGGACAGAGTTCACAGGAGGCCAGTGGGCGGGCCATGAGGGACAGGGTCTTTTTTCATTTCTTCCTCAGCTGGTTACTCAGGGTTCATCTGTCCATGGCCTTTCTAATAAACTGTTGAGTTGAAGCACG";
            var observedAlternateCds = GetAlternateCds(Resources.CacheGRCh37("ENST00000374163_chr1_Ensembl84"), "ENST00000374163", "1", 613,
                613, "C");
            Assert.Equal(expectedAlternateCds, observedAlternateCds);
        }

        [Fact]
        public void AlternateCdsReverse()
        {
            const string expectedAlternateCds = "ATGATGGAAAAAAACACCTCCGAGGGCCCTGCCTGCAGTCCAGAGGAGACCGCATCTGAATCTGCCAAGGTGCCCACAGCAGAGCCTCCCGGAGAAGTGGCAGTATCAGAGTCCACCAGAGAAGAGCAGGTGCCCAAGCCGCAGGCCCCTGCCCCACAGGCCCCTACAGCCTCCACAGCCACTAAGCCTGCACCCCCAAGTGAAGATGTCCCCAGTGCCCCACTGCTGCTGACCCTGGATGATGTGAGCAGCAGCTCTGTGACTGTGAGCTGGGAGCCCCCAGAGAGGCTGGGGAGGCTGGGCCTCCAGGGCTATGTGCTGGAGCTCTGCAGAGAGGGAGCCTCGGAGTGGGTGCCTGTGAGTGCCCGGCCCATGATGGTGACCCAGCAGACTGTGCGGAACCTGGCTCTGGGAGACAAGTTCCTCCTGCGCGTGTCTGCAGTGAGTTCTGCAGGGGCTGGCCCGCCGGCCATGCTGGACCAGCCCATCCACATCCGAGAGAACATTGAGGCCCCCAAGATCCGTGTCCCCCGCCACCTCCGTCAGACCTACATCCGCCAGGTGGGAGAGACGGTCAACCTGCAAATCCCCTTCCAGGGGAAGCCTAAGCCTCAGGCCACATGGACCCACAACGGCCATGCCCTGGACAGCCAGCGGGTGAGCATGCGCACCGGGGACCAGGACTCCATCCTCTTCATTCGCTCGGCCCAGCGCTCCGACTCTGGCCGCTACGAGCTCACTGTGCGCGTGGAAGACCTGGAGGCCAAGGCAGTCATTGACATCCTGGTGATTGAGAAACCTGGACCCCCCAGCAGCATCAGGCTCCTGGACGTCTGGGGCTGCAATGCTGCTCTTCAGTGGACGCCACCCCAGGACACAGGCAACACAGAGCTCCTGGGCTACATGGTGCAGAAGGCAGACAAAAAGACAGGGCAATGGTTCACAGTGCTGGAGCGCTACCACCCAACCACCTGCACCATCTCTGACCTCATCATCGGCAACTCGTACTCCTTCCGGGTCTTCTCAGAAAACCTGTGTGGACTCAGCACCTCGGCCACCGTCACCAAGGAGCTCGCCCACATCCAGAAGGCAGATATTGCTGCCAAACCTAAAGGGTTTATTGAGCGAGACTTCTCAGAAGCCCCCTCATTCACCCAGCCCCTGGCTGACCACACCTCCACCCCTGGCTACAGCACCCAGTTGTTCTGCAGTGTCCGAGCTTCACCCAAGCCCAAGATCATCTGGATGAAAAACAAGATGGAGATCCAGGGCAACCCCAAATACCGCGCCCTCTCTGAGCAAGGCGTCTGCACCCTAGAGATCCGGAAACCCAGCCCCTTTGATTCTGGGGTCTACACCTGCAAGGCCATAAATGTGCTGGGGGAGGCATCTGTGGACTGCCGGCTGGAGGTCAAAGCCTCAGCCGCACACTGGAGTCACGGGAGGAGGCTGTGATGAGGAGCCAGGTGCTGCAGGCCTGAGGGGCCAGGTCCACCAGGCCTACAGTCAAACTCCAGAGATGCCCAAGACCCCCGCTTCCATAGCGACGGCTGATGGAACCGCCCCTGGTACCTGCTGGCCTCCCTTCCCCAGAGGCTGGTGTCCAGAACTCAGGAATGGGCCTGGTAGGCCCCAGGCCAGACTAACTGGGCTCAAGGGGTGCTGGAAGGCGCAGAGATTGGAGTGCCCTGCGGAGTTGCACTCTGGGTGGGAAGCACTCAAATAAAGATGCGTGGTGTTAACAGTG";
            var observedAlternateCds = GetAlternateCds(Resources.CacheGRCh37("ENST00000255416_chr1_Ensembl84"), "ENST00000255416", "1",
                1434, 1434, "G");
            Assert.Equal(expectedAlternateCds, observedAlternateCds);
        }

        [Fact]
        public void AlternateCdsPaddedReverse()
        {
            const string expectedAlternateCds = "NNCAAAAACTCTGATACTGCTCATATTAAGTCCATAGAAATTACTTCGATCCTTAATGGACTTCAAGCTTCTGAAAGTTCTGCTGAAGACAGTGAGCAGGAAGATGAGAGAGGTGCTCAAGACATGGATAATAATGGCAAAGAGGAATCTAAGATTGATCATTTGACCAACAACAGAAATGATCTTATTTCAAAGGAGGAACAGAACAGTTCATCTTTGCTAGAAGAAAACAAAGTTCATGCAGATTTGGTAATATCCAAACCAGTGTCAAAATCTCCAGAAAGATTAAGGAAAGATATAGAAGTATTATCCGAAGATACTGATTATGAAGAAGATGAAGTCACAAAAAAGAGAAAGGATGTCAAGAAGGACACAACAGATAAATCTTCAAAACCACAAATAAAACGTGGTAAAAGAAGGTATTGCAATACAGAAGAGTGTCTAAAAACTGGATCACCTGGCAAAAAGGAAGAGAAGGCCAAGAACAAAGAATCACTTTGCATGGAAAACAGTAGCAACAGCTCTTCAGATGAAGATGAAGAAGAAACAAAAGCAAAGATGACACCAACTAAGAAATACAATGGTTTGGAGGAAAAAAGAAAATCTCTACGGACAACTGGTTTCTATTCAGGATTTTCAGAAGTGGCAGAAAAAAGGATTAAACTTTTAAATAACTCTGATGAAAGACTTCAAAACAGCAGGGCCAAAGATCGAAAAGATGTCTGGTCAAGTATTCAGGGACAGTGGCCTAAAAAAACGCTGAAAGAGCTTTTTTCAGACTCTGATACTGAGGCTGCAGCTTCCCCACCGCATCCTGCCCCAGAGGAGGGGGTGGCAGAGGAGTCACTGCAGACTGTGGCTGAAGAGGAGAGTTGTTCACCCAGTGTAGAACTAGAAAAACCACCTCCAGTCAATGTCGATAGTAAACCCATTGAAGAAAAAACAGTAGAGGTCAATGACAGAAAAGCAGAATTTCCAAGTAGTGGCAGTAATTCAGTGCTAAATACCCCTCCTACTACACCTGAATCGCCTTCATCAGTCACTGTAACAGAAGGCAGCCGGCAGCAGTCTTCTGTAACAGTATCAGAACCACTGGCTCCAAACCAAGAAGAGGTTCGAAGTATCAAGAGTGAAACTGATAGCACAATTGAGGTGGATAGTGTTGCTGGGGAGCTCCAAGACCTCCAGTCTGAAGGGAATAGCTCGCCAGCAGGTTTTGATGCCAGTGTGAGCTCAAGCAGTAGTAATCAGCCAGAACCAGAACATCCTGAAAAAGCCTGTACAGGTCAGAAAAGAGTGAAAGATGCTCAGGGAGGAGGAAGTTCATCAAAAAAGCAGAAAAGAAGCCATAAAGCAACAGTGGTAAACAACAAAAAGAAGGGAAAAGGCACAAATAGTAGTGATAGTGAAGAACTTTCAGCTGGTGAAAGTATAACTAAGAGTCAGCCAGTCAAATCAGTTTCCACTGGAATGAAGTCTCATAGTACCAAATCTCCCGCAAGGACGCAGTCTCCAGGAAAATGTGGAAAGAATGGTGATAAGGATCCTGATCTCAAGGAACCCAGTAATCGATTACCCAAAGTTTACAAATGGAGTTTTCAGATGTCGGACCTGGAAAATATGACAAGTGCCGAACGCATCACAATTCTTCAAGAAAAACTTCAAGAAATCAGAAAACATTATCTGTCATTAAAATCTGAAGTAGCTTCCATTGATCGGAGGAGAAAGCGTTTAAAGAAGAAAGAGAGAGAAAGTGCTGCTACATCCTCATCCTCCTCTTCACCTTCATCCAGTTCCATAACAGCTGCTGTTATGTTAACTTTAGCTGAACCGTCAATGTCCAGCGCATCACAAAATGGAATGCTTCAACCACTCCCAGAAGACGTCCTTCACTCCCAAAATGAGGCTTTTCTGAAACGGCGAGGACCACCAACCGACGGCGACAAACCTGCTCCCTCACCCAGCGCCTCCCTTCGCCGCCGCCCGGCGGCCGACTGCCGGAGGGGAGGGGGCGTGGCCAGAGAGCGGAAGTGCCCGGAACCCGGAAGTGCGAGCTGGCGCGCAGCTGCAGTCTGGGAGTCTTTGGAGTTAGAATGGCCTTGGAAGGGATGAGCAAACGGAAGAGAAAGAGAAGTGTCCAGGAGGGAGAGAATCCTGACGACGGCGTTCGCGGGAGTCCGCCGGAAGACTACAGGCTTGGACAGGTCGCCAGTAGCTTATTTCGCGGCGAACACCATTCCAGAGGTGGCACCGGTCGGCTGGCGTCCCTCTTCAGTTCTCTGGAGCCCCAGATTCAACCCGTGTACGTGCCTGTGCCTAAACAAACCATCAAAAAAACGAAACGGAATGAGGAGGAAGAAAGTACATCCCAGATTGAAAGACCACTTTCGCAAGAACCTGCCAAAAAAGTGAAAGCGAAGAAGAAACACACTAACGCAGAAAAAAAGTTGGCAGACAGGGAAAGCGCTCTAGCGAGTGCTGATTTAGAAGAAGAAATTCACCAGAAACAAGGGCAGAAAAGGAAAAATTCTCAACCTGGTGTTAAAGTAGCAGATAGAAAAATACTTGATGACACAGAAGACACAGTTGTCAGTCAAAGAAAGAAAATTCAAATCAACCAAGAAGAAGAGAGATTAAAGAATGAGAGAACTGTGTTTGTTGGGAATTTGCCTGTTACATGTAATAAGAAGAAGCTGAAGTCGTTTTTTAAAGAGTATGGACAAATAGAATCTGTACGATTTCGTTCTCTGATTCCAGCAGAGGGAACGCTATCCAAAAAGTTGGCAGCAATAAAACGTAAAATTCATCCTGATCAGAAAAATATTAATGCCTATGTTGTGTTTAAGGAGGAGAGTGCTGCCACGCAAGCATTGAAAAGAAATGGGGCCCAGATTGCAGATGGATTTCGTATTAGAGTTGATCTCGCATCTGAGACCTCATCTAGAGACAAGAGATCGGTTTTTGTGGGGAATCTCCCTTATAAAGTTGAAGAATCTGCCATTGAGAAGCACTTTCTGGACTGTGGAAGTATCATGGCCGTGAGGATTGTGAGAGACAAAATGACAGGCATCGGCAAAGGGTTTGGCTATGTGCTCTTTGAGAATACAGATTCTGTTCATCTTGCTCTGAAATTAAATAATTCTGAACTCATGGGGAGAAAACTCAGAGTCATGCGTTCTGTTAATAAAGAAAAATTTAAACAACAAAATTCAAATCCACGATTGAAGAATGTCAGTAAACCTAAGCAGGGACTTAATTTTACTTCCAAAACTGCAGAAGGACATCCTAAAAGCTTATTTATTGGAGAAAAAGCTGTTCTCCTTAAAACGAAGAAGAAAGGACAGAAGAAAAGTGGACGCCCTAAGAAACAGAGAAAACAGAAATAACAACCAGGAACTGCTTTTTCTTTTCCTGCTGAGTACTGCTAATAAAAGTGCTATTATCTGCTGATAGCATCGTCTGCTA";
            var observedAlternateCds = GetAlternateCds(Resources.CacheGRCh37("ENST00000474953_chr1_Ensembl84"), "ENST00000474953", "1",
                2090, 2090, "T");
            Assert.Equal(expectedAlternateCds, observedAlternateCds);
        }

        private static string GetAlternateCds(string cacheStub, string transcriptId, string ensemblRefName, int start, int end, string allele)
        {
            var transcript = DataUtilities.FindTranscript(cacheStub, transcriptId);
            Assert.NotNull(transcript);

            var sequence = DataUtilities.GetCompressedSequence(cacheStub, ensemblRefName);
            Assert.NotNull(sequence);

            return TranscriptUtilities.GetAlternateCds(sequence, start, end, allele, transcript.CdnaMaps,
                transcript.Gene.OnReverseStrand, transcript.StartExonPhase,
                transcript.Translation.CodingRegion.CdnaStart);
        }
    }
}
