using System.Collections.Generic;
using System.IO;
using System.Linq;
using Genome;
using SAUtils.DataStructures;
using SAUtils.InputFileParsers;
using UnitTests.TestDataStructures;
using VariantAnnotation.Interface.SA;
using Variants;
using Xunit;

namespace UnitTests.SAUtils.InputFileParsers
{
    public sealed class GnomadReaderTests
    {
        private static readonly IChromosome Chrom1 = new Chromosome("chr1", "1", 1);
        private static readonly IChromosome Chrom22 = new Chromosome("chr22", "22", 22);

        private static Stream GetGnomadStream()
        {
            var stream = new MemoryStream();
            var writer = new StreamWriter(stream);

            writer.WriteLine("##gnomAD");
            writer.WriteLine("#CHROM\tPOS\tID\tREF\tALT\tQUAL\tFILTER\tINFO");
            writer.WriteLine("1\t10114\t.\tT\tC\t36728.97\tAC0;RF\tAC=0;AN=8734;AF=0.00000e+00;rf_tp_probability=5.81047e-03;FS=2.19320e+01;InbreedingCoeff=2.08000e-01;MQ=3.32800e+01;MQRankSum=-1.23200e+00;QD=2.00800e+01;ReadPosRankSum=-9.11000e-01;SOR=2.51400e+00;BaseQRankSum=8.30000e-02;ClippingRankSum=-2.05000e-01;DP=1908083;VQSLOD=-1.50700e+01;VQSR_culprit=DP;segdup;lcr;variant_type=mixed;allele_type=snv;n_alt_alleles=2;was_mixed;has_star;pab_max=2.49392e-03;gq_hist_alt_bin_freq=1|2|0|0|1|1|0|0|0|0|2|0|0|1|0|0|0|0|0|1;gq_hist_all_bin_freq=10978|910|716|1408|1386|700|972|662|271|352|254|154|300|62|122|79|163|24|118|405;dp_hist_alt_bin_freq=0|0|0|0|1|4|1|1|0|1|0|1|0|0|0|0|0|0|0|0;dp_hist_alt_n_larger=0;dp_hist_all_bin_freq=6|21|53|72|123|178|300|514|808|1076|1385|1481|1545|1531|1406|1127|957|795|618|618;dp_hist_all_n_larger=5700;ab_hist_alt_bin_freq=0|4|4|1|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0;AC_nfe_seu=0;AN_nfe_seu=72;AF_nfe_seu=0.00000e+00;nhomalt_nfe_seu=0;controls_AC_afr_male=0;controls_AN_afr_male=380;controls_AF_afr_male=0.00000e+00;controls_nhomalt_afr_male=0;non_topmed_AC_amr=0;non_topmed_AN_amr=314;non_topmed_AF_amr=0.00000e+00;non_topmed_nhomalt_amr=0;AC_raw=8;AN_raw=31192;AF_raw=2.56476e-04;nhomalt_raw=0;AC_fin_female=0;AN_fin_female=700;AF_fin_female=0.00000e+00;nhomalt_fin_female=0;non_neuro_AC_asj_female=0;non_neuro_AN_asj_female=28;non_neuro_AF_asj_female=0.00000e+00;non_neuro_nhomalt_asj_female=0;non_neuro_AC_afr_male=0;non_neuro_AN_afr_male=450;non_neuro_AF_afr_male=0.00000e+00;non_neuro_nhomalt_afr_male=0;AC_afr_male=0;AN_afr_male=1250;AF_afr_male=0.00000e+00;nhomalt_afr_male=0;AC_afr=0;AN_afr=2168;AF_afr=0.00000e+00;nhomalt_afr=0;non_neuro_AC_afr_female=0;non_neuro_AN_afr_female=472;non_neuro_AF_afr_female=0.00000e+00;non_neuro_nhomalt_afr_female=0;non_topmed_AC_amr_female=0;non_topmed_AN_amr_female=138;non_topmed_AF_amr_female=0.00000e+00;non_topmed_nhomalt_amr_female=0;non_topmed_AC_oth_female=0;non_topmed_AN_oth_female=168;non_topmed_AF_oth_female=0.00000e+00;non_topmed_nhomalt_oth_female=0;AC_eas_female=0;AN_eas_female=130;AF_eas_female=0.00000e+00;nhomalt_eas_female=0;AC_afr_female=0;AN_afr_female=918;AF_afr_female=0.00000e+00;nhomalt_afr_female=0;non_neuro_AC_female=0;non_neuro_AN_female=2452;non_neuro_AF_female=0.00000e+00;non_neuro_nhomalt_female=0;controls_AC_afr=0;controls_AN_afr=700;controls_AF_afr=0.00000e+00;controls_nhomalt_afr=0;AC_nfe_onf=0;AN_nfe_onf=748;AF_nfe_onf=0.00000e+00;nhomalt_nfe_onf=0;controls_AC_fin_male=0;controls_AN_fin_male=236;controls_AF_fin_male=0.00000e+00;controls_nhomalt_fin_male=0;non_neuro_AC_nfe_nwe=0;non_neuro_AN_nfe_nwe=1928;non_neuro_AF_nfe_nwe=0.00000e+00;non_neuro_nhomalt_nfe_nwe=0;AC_fin_male=0;AN_fin_male=596;AF_fin_male=0.00000e+00;nhomalt_fin_male=0;AC_nfe_female=0;AN_nfe_female=1732;AF_nfe_female=0.00000e+00;nhomalt_nfe_female=0;AC_amr=0;AN_amr=324;AF_amr=0.00000e+00;nhomalt_amr=0;non_topmed_AC_nfe_male=0;non_topmed_AN_nfe_male=1628;non_topmed_AF_nfe_male=0.00000e+00;non_topmed_nhomalt_nfe_male=0;AC_eas=0;AN_eas=438;AF_eas=0.00000e+00;nhomalt_eas=0;nhomalt=0;non_neuro_AC_nfe_female=0;non_neuro_AN_nfe_female=1380;non_neuro_AF_nfe_female=0.00000e+00;non_neuro_nhomalt_nfe_female=0;non_neuro_AC_afr=0;non_neuro_AN_afr=922;non_neuro_AF_afr=0.00000e+00;non_neuro_nhomalt_afr=0;controls_AC_raw=4;controls_AN_raw=10778;controls_AF_raw=3.71126e-04;controls_nhomalt_raw=0;controls_AC_male=0;controls_AN_male=1690;controls_AF_male=0.00000e+00;controls_nhomalt_male=0;non_topmed_AC_male=0;non_topmed_AN_male=4134;non_topmed_AF_male=0.00000e+00;non_topmed_nhomalt_male=0;controls_AC_nfe_female=0;controls_AN_nfe_female=622;controls_AF_nfe_female=0.00000e+00;controls_nhomalt_nfe_female=0;non_neuro_AC_amr=0;non_neuro_AN_amr=196;non_neuro_AF_amr=0.00000e+00;non_neuro_nhomalt_amr=0;non_neuro_AC_eas_female=0;non_neuro_AN_eas_female=130;non_neuro_AF_eas_female=0.00000e+00;non_neuro_nhomalt_eas_female=0;AC_asj_male=0;AN_asj_male=56;AF_asj_male=0.00000e+00;nhomalt_asj_male=0;controls_AC_nfe_male=0;controls_AN_nfe_male=764;controls_AF_nfe_male=0.00000e+00;controls_nhomalt_nfe_male=0;non_neuro_AC_fin=0;non_neuro_AN_fin=494;non_neuro_AF_fin=0.00000e+00;non_neuro_nhomalt_fin=0;AC_oth_female=0;AN_oth_female=170;AF_oth_female=0.00000e+00;nhomalt_oth_female=0;controls_AC_nfe=0;controls_AN_nfe=1386;controls_AF_nfe=0.00000e+00;controls_nhomalt_nfe=0;controls_AC_oth_female=0;controls_AN_oth_female=60;controls_AF_oth_female=0.00000e+00;controls_nhomalt_oth_female=0;controls_AC_asj=0;controls_AN_asj=24;controls_AF_asj=0.00000e+00;controls_nhomalt_asj=0;non_neuro_AC_amr_male=0;non_neuro_AN_amr_male=98;non_neuro_AF_amr_male=0.00000e+00;non_neuro_nhomalt_amr_male=0;controls_AC_nfe_nwe=0;controls_AN_nfe_nwe=398;controls_AF_nfe_nwe=0.00000e+00;controls_nhomalt_nfe_nwe=0;AC_nfe_nwe=0;AN_nfe_nwe=2370;AF_nfe_nwe=0.00000e+00;nhomalt_nfe_nwe=0;controls_AC_nfe_seu=0;controls_AN_nfe_seu=42;controls_AF_nfe_seu=0.00000e+00;controls_nhomalt_nfe_seu=0;non_neuro_AC_amr_female=0;non_neuro_AN_amr_female=98;non_neuro_AF_amr_female=0.00000e+00;non_neuro_nhomalt_amr_female=0;non_neuro_AC_nfe_onf=0;non_neuro_AN_nfe_onf=512;non_neuro_AF_nfe_onf=0.00000e+00;non_neuro_nhomalt_nfe_onf=0;non_topmed_AC_eas_male=0;non_topmed_AN_eas_male=306;non_topmed_AF_eas_male=0.00000e+00;non_topmed_nhomalt_eas_male=0;controls_AC_amr_female=0;controls_AN_amr_female=48;controls_AF_amr_female=0.00000e+00;controls_nhomalt_amr_female=0;non_neuro_AC_fin_male=0;non_neuro_AN_fin_male=236;non_neuro_AF_fin_male=0.00000e+00;non_neuro_nhomalt_fin_male=0;AC_female=0;AN_female=3836;AF_female=0.00000e+00;nhomalt_female=0;non_neuro_AC_oth_male=0;non_neuro_AN_oth_male=108;non_neuro_AF_oth_male=0.00000e+00;non_neuro_nhomalt_oth_male=0;non_topmed_AC_nfe_est=0;non_topmed_AN_nfe_est=860;non_topmed_AF_nfe_est=0.00000e+00;non_topmed_nhomalt_nfe_est=0;non_topmed_AC_nfe_nwe=0;non_topmed_AN_nfe_nwe=1588;non_topmed_AF_nfe_nwe=0.00000e+00;non_topmed_nhomalt_nfe_nwe=0;non_topmed_AC_amr_male=0;non_topmed_AN_amr_male=176;non_topmed_AF_amr_male=0.00000e+00;non_topmed_nhomalt_amr_male=0;non_topmed_AC_nfe_onf=0;non_topmed_AN_nfe_onf=618;non_topmed_AF_nfe_onf=0.00000e+00;non_topmed_nhomalt_nfe_onf=0;controls_AC_eas_male=0;controls_AN_eas_male=184;controls_AF_eas_male=0.00000e+00;controls_nhomalt_eas_male=0;controls_AC_oth_male=0;controls_AN_oth_male=52;controls_AF_oth_male=0.00000e+00;controls_nhomalt_oth_male=0;non_topmed_AC=0;non_topmed_AN=7716;non_topmed_AF=0.00000e+00;non_topmed_nhomalt=0;controls_AC_fin=0;controls_AN_fin=494;controls_AF_fin=0.00000e+00;controls_nhomalt_fin=0;non_neuro_AC_nfe=0;non_neuro_AN_nfe=3216;non_neuro_AF_nfe=0.00000e+00;non_neuro_nhomalt_nfe=0;non_neuro_AC_fin_female=0;non_neuro_AN_fin_female=258;non_neuro_AF_fin_female=0.00000e+00;non_neuro_nhomalt_fin_female=0;non_topmed_AC_nfe_seu=0;non_topmed_AN_nfe_seu=72;non_topmed_AF_nfe_seu=0.00000e+00;non_topmed_nhomalt_nfe_seu=0;controls_AC_eas_female=0;controls_AN_eas_female=80;controls_AF_eas_female=0.00000e+00;controls_nhomalt_eas_female=0;non_topmed_AC_asj=0;non_topmed_AN_asj=72;non_topmed_AF_asj=0.00000e+00;non_topmed_nhomalt_asj=0;controls_AC_nfe_onf=0;controls_AN_nfe_onf=216;controls_AF_nfe_onf=0.00000e+00;controls_nhomalt_nfe_onf=0;non_neuro_AC=0;non_neuro_AN=5526;non_neuro_AF=0.00000e+00;non_neuro_nhomalt=0;non_topmed_AC_nfe=0;non_topmed_AN_nfe=3138;non_topmed_AF_nfe=0.00000e+00;non_topmed_nhomalt_nfe=0;non_topmed_AC_raw=8;non_topmed_AN_raw=26404;non_topmed_AF_raw=3.02984e-04;non_topmed_nhomalt_raw=0;non_neuro_AC_nfe_est=0;non_neuro_AN_nfe_est=736;non_neuro_AF_nfe_est=0.00000e+00;non_neuro_nhomalt_nfe_est=0;non_topmed_AC_oth_male=0;non_topmed_AN_oth_male=170;non_topmed_AF_oth_male=0.00000e+00;non_topmed_nhomalt_oth_male=0;AC_nfe_est=0;AN_nfe_est=864;AF_nfe_est=0.00000e+00;nhomalt_nfe_est=0;non_topmed_AC_afr_male=0;non_topmed_AN_afr_male=1228;non_topmed_AF_afr_male=0.00000e+00;non_topmed_nhomalt_afr_male=0;AC_eas_male=0;AN_eas_male=308;AF_eas_male=0.00000e+00;nhomalt_eas_male=0;controls_AC_eas=0;controls_AN_eas=264;controls_AF_eas=0.00000e+00;controls_nhomalt_eas=0;non_neuro_AC_eas_male=0;non_neuro_AN_eas_male=308;non_neuro_AF_eas_male=0.00000e+00;non_neuro_nhomalt_eas_male=0;non_neuro_AC_asj_male=0;non_neuro_AN_asj_male=38;non_neuro_AF_asj_male=0.00000e+00;non_neuro_nhomalt_asj_male=0;controls_AC_oth=0;controls_AN_oth=112;controls_AF_oth=0.00000e+00;controls_nhomalt_oth=0;AC_nfe=0;AN_nfe=4054;AF_nfe=0.00000e+00;nhomalt_nfe=0;non_topmed_AC_female=0;non_topmed_AN_female=3582;non_topmed_AF_female=0.00000e+00;non_topmed_nhomalt_female=0;non_neuro_AC_asj=0;non_neuro_AN_asj=66;non_neuro_AF_asj=0.00000e+00;non_neuro_nhomalt_asj=0;non_topmed_AC_eas_female=0;non_topmed_AN_eas_female=126;non_topmed_AF_eas_female=0.00000e+00;non_topmed_nhomalt_eas_female=0;non_neuro_AC_raw=4;non_neuro_AN_raw=21142;non_neuro_AF_raw=1.89197e-04;non_neuro_nhomalt_raw=0;non_topmed_AC_eas=0;non_topmed_AN_eas=432;non_topmed_AF_eas=0.00000e+00;non_topmed_nhomalt_eas=0;non_topmed_AC_fin_male=0;non_topmed_AN_fin_male=596;non_topmed_AF_fin_male=0.00000e+00;non_topmed_nhomalt_fin_male=0;AC_fin=0;AN_fin=1296;AF_fin=0.00000e+00;nhomalt_fin=0;AC_nfe_male=0;AN_nfe_male=2322;AF_nfe_male=0.00000e+00;nhomalt_nfe_male=0;controls_AC_amr_male=0;controls_AN_amr_male=68;controls_AF_amr_male=0.00000e+00;controls_nhomalt_amr_male=0;controls_AC_afr_female=0;controls_AN_afr_female=320;controls_AF_afr_female=0.00000e+00;controls_nhomalt_afr_female=0;controls_AC_amr=0;controls_AN_amr=116;controls_AF_amr=0.00000e+00;controls_nhomalt_amr=0;AC_asj_female=0;AN_asj_female=44;AF_asj_female=0.00000e+00;nhomalt_asj_female=0;non_neuro_AC_eas=0;non_neuro_AN_eas=438;non_neuro_AF_eas=0.00000e+00;non_neuro_nhomalt_eas=0;non_neuro_AC_male=0;non_neuro_AN_male=3074;non_neuro_AF_male=0.00000e+00;non_neuro_nhomalt_male=0;AC_asj=0;AN_asj=100;AF_asj=0.00000e+00;nhomalt_asj=0;controls_AC_nfe_est=0;controls_AN_nfe_est=730;controls_AF_nfe_est=0.00000e+00;controls_nhomalt_nfe_est=0;non_topmed_AC_asj_female=0;non_topmed_AN_asj_female=42;non_topmed_AF_asj_female=0.00000e+00;non_topmed_nhomalt_asj_female=0;non_topmed_AC_oth=0;non_topmed_AN_oth=338;non_topmed_AF_oth=0.00000e+00;non_topmed_nhomalt_oth=0;non_topmed_AC_fin_female=0;non_topmed_AN_fin_female=700;non_topmed_AF_fin_female=0.00000e+00;non_topmed_nhomalt_fin_female=0;AC_oth=0;AN_oth=354;AF_oth=0.00000e+00;nhomalt_oth=0;non_neuro_AC_nfe_male=0;non_neuro_AN_nfe_male=1836;non_neuro_AF_nfe_male=0.00000e+00;non_neuro_nhomalt_nfe_male=0;controls_AC_female=0;controls_AN_female=1406;controls_AF_female=0.00000e+00;controls_nhomalt_female=0;non_topmed_AC_fin=0;non_topmed_AN_fin=1296;non_topmed_AF_fin=0.00000e+00;non_topmed_nhomalt_fin=0;non_topmed_AC_nfe_female=0;non_topmed_AN_nfe_female=1510;non_topmed_AF_nfe_female=0.00000e+00;non_topmed_nhomalt_nfe_female=0;controls_AC_asj_male=0;controls_AN_asj_male=6;controls_AF_asj_male=0.00000e+00;controls_nhomalt_asj_male=0;non_topmed_AC_asj_male=0;non_topmed_AN_asj_male=30;non_topmed_AF_asj_male=0.00000e+00;non_topmed_nhomalt_asj_male=0;non_neuro_AC_oth=0;non_neuro_AN_oth=194;non_neuro_AF_oth=0.00000e+00;non_neuro_nhomalt_oth=0;AC_male=0;AN_male=4898;AF_male=0.00000e+00;nhomalt_male=0;controls_AC_fin_female=0;controls_AN_fin_female=258;controls_AF_fin_female=0.00000e+00;controls_nhomalt_fin_female=0;controls_AC_asj_female=0;controls_AN_asj_female=18;controls_AF_asj_female=0.00000e+00;controls_nhomalt_asj_female=0;AC_amr_male=0;AN_amr_male=182;AF_amr_male=0.00000e+00;nhomalt_amr_male=0;AC_amr_female=0;AN_amr_female=142;AF_amr_female=0.00000e+00;nhomalt_amr_female=0;AC_oth_male=0;AN_oth_male=184;AF_oth_male=0.00000e+00;nhomalt_oth_male=0;non_neuro_AC_nfe_seu=0;non_neuro_AN_nfe_seu=40;non_neuro_AF_nfe_seu=0.00000e+00;non_neuro_nhomalt_nfe_seu=0;non_topmed_AC_afr_female=0;non_topmed_AN_afr_female=898;non_topmed_AF_afr_female=0.00000e+00;non_topmed_nhomalt_afr_female=0;non_topmed_AC_afr=0;non_topmed_AN_afr=2126;non_topmed_AF_afr=0.00000e+00;non_topmed_nhomalt_afr=0;controls_AC=0;controls_AN=3096;controls_AF=0.00000e+00;controls_nhomalt=0;non_neuro_AC_oth_female=0;non_neuro_AN_oth_female=86;non_neuro_AF_oth_female=0.00000e+00;non_neuro_nhomalt_oth_female=0;non_topmed_faf95_amr=0.00000e+00;non_topmed_faf99_amr=0.00000e+00;faf95_afr=0.00000e+00;faf99_afr=0.00000e+00;controls_faf95_afr=0.00000e+00;controls_faf99_afr=0.00000e+00;faf95_amr=0.00000e+00;faf99_amr=0.00000e+00;faf95_eas=0.00000e+00;faf99_eas=0.00000e+00;faf95=0.00000e+00;faf99=0.00000e+00;non_neuro_faf95_afr=0.00000e+00;non_neuro_faf99_afr=0.00000e+00;non_neuro_faf95_amr=0.00000e+00;non_neuro_faf99_amr=0.00000e+00;controls_faf95_nfe=0.00000e+00;controls_faf99_nfe=0.00000e+00;non_topmed_faf95=0.00000e+00;non_topmed_faf99=0.00000e+00;non_neuro_faf95_nfe=0.00000e+00;non_neuro_faf99_nfe=0.00000e+00;non_neuro_faf95=0.00000e+00;non_neuro_faf99=0.00000e+00;non_topmed_faf95_nfe=0.00000e+00;non_topmed_faf99_nfe=0.00000e+00;controls_faf95_eas=0.00000e+00;controls_faf99_eas=0.00000e+00;faf95_nfe=0.00000e+00;faf99_nfe=0.00000e+00;non_topmed_faf95_eas=0.00000e+00;non_topmed_faf99_eas=0.00000e+00;controls_faf95_amr=0.00000e+00;controls_faf99_amr=0.00000e+00;non_neuro_faf95_eas=0.00000e+00;non_neuro_faf99_eas=0.00000e+00;non_topmed_faf95_afr=0.00000e+00;non_topmed_faf99_afr=0.00000e+00;controls_faf95=0.00000e+00;controls_faf99=0.00000e+00;age_hist_het_bin_freq=0|0|0|0|0|0|0|0|0|0;age_hist_het_n_smaller=0;age_hist_het_n_larger=0;age_hist_hom_bin_freq=0|0|0|0|0|0|0|0|0|0;age_hist_hom_n_smaller=0;age_hist_hom_n_larger=0;vep=C|downstream_gene_variant|MODIFIER|WASH7P|ENSG00000227232|Transcript|ENST00000423562|unprocessed_pseudogene|||||||||||1|4249|-1||SNV|1|HGNC|38034||||||||||||||||||||||||||||||||||||||||||,C|downstream_gene_variant|MODIFIER|WASH7P|ENSG00000227232|Transcript|ENST00000438504|unprocessed_pseudogene|||||||||||1|4249|-1||SNV|1|HGNC|38034|YES|||||||||||||||||||||||||||||||||||||||||,C|upstream_gene_variant|MODIFIER|DDX11L1|ENSG00000223972|Transcript|ENST00000450305|transcribed_unprocessed_pseudogene|||||||||||1|1896|1||SNV|1|HGNC|37102||||||||||||||||||||||||||||||||||||||||||,C|upstream_gene_variant|MODIFIER|DDX11L1|ENSG00000223972|Transcript|ENST00000456328|processed_transcript|||||||||||1|1755|1||SNV|1|HGNC|37102|YES|||||||||||||||||||||||||||||||||||||||||,C|downstream_gene_variant|MODIFIER|WASH7P|ENSG00000227232|Transcript|ENST00000488147|unprocessed_pseudogene|||||||||||1|4290|-1||SNV|1|HGNC|38034||||||||||||||||||||||||||||||||||||||||||,C|upstream_gene_variant|MODIFIER|DDX11L1|ENSG00000223972|Transcript|ENST00000515242|transcribed_unprocessed_pseudogene|||||||||||1|1758|1||SNV|1|HGNC|37102||||||||||||||||||||||||||||||||||||||||||,C|upstream_gene_variant|MODIFIER|DDX11L1|ENSG00000223972|Transcript|ENST00000518655|transcribed_unprocessed_pseudogene|||||||||||1|1760|1||SNV|1|HGNC|37102||||||||||||||||||||||||||||||||||||||||||,C|downstream_gene_variant|MODIFIER|WASH7P|ENSG00000227232|Transcript|ENST00000538476|unprocessed_pseudogene|||||||||||1|4297|-1||SNV|1|HGNC|38034||||||||||||||||||||||||||||||||||||||||||,C|downstream_gene_variant|MODIFIER|WASH7P|ENSG00000227232|Transcript|ENST00000541675|unprocessed_pseudogene|||||||||||1|4249|-1||SNV|1|HGNC|38034||||||||||||||||||||||||||||||||||||||||||,C|regulatory_region_variant|MODIFIER|||RegulatoryFeature|ENSR00001576074|CTCF_binding_site|||||||||||1||||SNV|1||||||||||||||||||||||||||||||||||||||||||||");
            writer.WriteLine("1\t10120\trs1390810297\tT\tC\t14928.74\tAC0;RF\tAC=0;AN=12354;AF=0.00000e+00;rf_tp_probability=2.34392e-02;FS=0.00000e+00;InbreedingCoeff=7.07000e-02;MQ=3.48700e+01;MQRankSum=-3.93000e-01;QD=2.47200e+01;ReadPosRankSum=-8.67000e-01;SOR=7.59000e-01;BaseQRankSum=-1.80000e-01;ClippingRankSum=-1.67000e-01;DP=1863750;VQSLOD=-9.10400e+00;VQSR_culprit=DP;segdup;lcr;variant_type=snv;allele_type=snv;n_alt_alleles=1;has_star;pab_max=8.55446e-04;gq_hist_alt_bin_freq=2|0|0|0|0|2|1|0|0|0|1|0|1|0|2|0|0|1|0|0;gq_hist_all_bin_freq=9073|729|735|1314|1588|868|1354|1001|433|603|420|184|395|85|192|74|211|33|162|545;dp_hist_alt_bin_freq=0|0|0|0|4|2|1|0|1|0|0|2|0|0|0|0|0|0|0|0;dp_hist_alt_n_larger=0;dp_hist_all_bin_freq=6|21|63|83|135|212|362|594|905|1161|1441|1520|1521|1501|1358|1094|866|752|614|575;dp_hist_all_n_larger=5530;ab_hist_alt_bin_freq=0|5|5|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0;AC_nfe_seu=0;AN_nfe_seu=86;AF_nfe_seu=0.00000e+00;nhomalt_nfe_seu=0;controls_AC_afr_male=0;controls_AN_afr_male=542;controls_AF_afr_male=0.00000e+00;controls_nhomalt_afr_male=0;non_topmed_AC_amr=0;non_topmed_AN_amr=370;non_topmed_AF_amr=0.00000e+00;non_topmed_nhomalt_amr=0;AC_raw=9;AN_raw=31190;AF_raw=2.88554e-04;nhomalt_raw=0;AC_fin_female=0;AN_fin_female=836;AF_fin_female=0.00000e+00;nhomalt_fin_female=0;non_neuro_AC_asj_female=0;non_neuro_AN_asj_female=30;non_neuro_AF_asj_female=0.00000e+00;non_neuro_nhomalt_asj_female=0;non_neuro_AC_afr_male=0;non_neuro_AN_afr_male=628;non_neuro_AF_afr_male=0.00000e+00;non_neuro_nhomalt_afr_male=0;AC_afr_male=0;AN_afr_male=1896;AF_afr_male=0.00000e+00;nhomalt_afr_male=0;AC_afr=0;AN_afr=3222;AF_afr=0.00000e+00;nhomalt_afr=0;non_neuro_AC_afr_female=0;non_neuro_AN_afr_female=648;non_neuro_AF_afr_female=0.00000e+00;non_neuro_nhomalt_afr_female=0;non_topmed_AC_amr_female=0;non_topmed_AN_amr_female=156;non_topmed_AF_amr_female=0.00000e+00;non_topmed_nhomalt_amr_female=0;non_topmed_AC_oth_female=0;non_topmed_AN_oth_female=230;non_topmed_AF_oth_female=0.00000e+00;non_topmed_nhomalt_oth_female=0;AC_eas_female=0;AN_eas_female=210;AF_eas_female=0.00000e+00;nhomalt_eas_female=0;AC_afr_female=0;AN_afr_female=1326;AF_afr_female=0.00000e+00;nhomalt_afr_female=0;non_neuro_AC_female=0;non_neuro_AN_female=3530;non_neuro_AF_female=0.00000e+00;non_neuro_nhomalt_female=0;controls_AC_afr=0;controls_AN_afr=962;controls_AF_afr=0.00000e+00;controls_nhomalt_afr=0;AC_nfe_onf=0;AN_nfe_onf=966;AF_nfe_onf=0.00000e+00;nhomalt_nfe_onf=0;controls_AC_fin_male=0;controls_AN_fin_male=296;controls_AF_fin_male=0.00000e+00;controls_nhomalt_fin_male=0;non_neuro_AC_nfe_nwe=0;non_neuro_AN_nfe_nwe=2760;non_neuro_AF_nfe_nwe=0.00000e+00;non_neuro_nhomalt_nfe_nwe=0;AC_fin_male=0;AN_fin_male=730;AF_fin_male=0.00000e+00;nhomalt_fin_male=0;AC_nfe_female=0;AN_nfe_female=2526;AF_nfe_female=0.00000e+00;nhomalt_nfe_female=0;AC_amr=0;AN_amr=386;AF_amr=0.00000e+00;nhomalt_amr=0;non_topmed_AC_nfe_male=0;non_topmed_AN_nfe_male=2332;non_topmed_AF_nfe_male=0.00000e+00;non_topmed_nhomalt_nfe_male=0;AC_eas=0;AN_eas=638;AF_eas=0.00000e+00;nhomalt_eas=0;nhomalt=0;non_neuro_AC_nfe_female=0;non_neuro_AN_nfe_female=2124;non_neuro_AF_nfe_female=0.00000e+00;non_neuro_nhomalt_nfe_female=0;non_neuro_AC_afr=0;non_neuro_AN_afr=1276;non_neuro_AF_afr=0.00000e+00;non_neuro_nhomalt_afr=0;controls_AC_raw=4;controls_AN_raw=10788;controls_AF_raw=3.70782e-04;controls_nhomalt_raw=0;controls_AC_male=0;controls_AN_male=2404;controls_AF_male=0.00000e+00;controls_nhomalt_male=0;non_topmed_AC_male=0;non_topmed_AN_male=5818;non_topmed_AF_male=0.00000e+00;non_topmed_nhomalt_male=0;controls_AC_nfe_female=0;controls_AN_nfe_female=956;controls_AF_nfe_female=0.00000e+00;controls_nhomalt_nfe_female=0;non_neuro_AC_amr=0;non_neuro_AN_amr=218;non_neuro_AF_amr=0.00000e+00;non_neuro_nhomalt_amr=0;non_neuro_AC_eas_female=0;non_neuro_AN_eas_female=210;non_neuro_AF_eas_female=0.00000e+00;non_neuro_nhomalt_eas_female=0;AC_asj_male=0;AN_asj_male=90;AF_asj_male=0.00000e+00;nhomalt_asj_male=0;controls_AC_nfe_male=0;controls_AN_nfe_male=1162;controls_AF_nfe_male=0.00000e+00;controls_nhomalt_nfe_male=0;non_neuro_AC_fin=0;non_neuro_AN_fin=562;non_neuro_AF_fin=0.00000e+00;non_neuro_nhomalt_fin=0;AC_oth_female=0;AN_oth_female=234;AF_oth_female=0.00000e+00;nhomalt_oth_female=0;controls_AC_nfe=0;controls_AN_nfe=2118;controls_AF_nfe=0.00000e+00;controls_nhomalt_nfe=0;controls_AC_oth_female=0;controls_AN_oth_female=102;controls_AF_oth_female=0.00000e+00;controls_nhomalt_oth_female=0;controls_AC_asj=0;controls_AN_asj=26;controls_AF_asj=0.00000e+00;controls_nhomalt_asj=0;non_neuro_AC_amr_male=0;non_neuro_AN_amr_male=104;non_neuro_AF_amr_male=0.00000e+00;non_neuro_nhomalt_amr_male=0;controls_AC_nfe_nwe=0;controls_AN_nfe_nwe=438;controls_AF_nfe_nwe=0.00000e+00;controls_nhomalt_nfe_nwe=0;AC_nfe_nwe=0;AN_nfe_nwe=3296;AF_nfe_nwe=0.00000e+00;nhomalt_nfe_nwe=0;controls_AC_nfe_seu=0;controls_AN_nfe_seu=48;controls_AF_nfe_seu=0.00000e+00;controls_nhomalt_nfe_seu=0;non_neuro_AC_amr_female=0;non_neuro_AN_amr_female=114;non_neuro_AF_amr_female=0.00000e+00;non_neuro_nhomalt_amr_female=0;non_neuro_AC_nfe_onf=0;non_neuro_AN_nfe_onf=702;non_neuro_AF_nfe_onf=0.00000e+00;non_neuro_nhomalt_nfe_onf=0;non_topmed_AC_eas_male=0;non_topmed_AN_eas_male=418;non_topmed_AF_eas_male=0.00000e+00;non_topmed_nhomalt_eas_male=0;controls_AC_amr_female=0;controls_AN_amr_female=44;controls_AF_amr_female=0.00000e+00;controls_nhomalt_amr_female=0;non_neuro_AC_fin_male=0;non_neuro_AN_fin_male=296;non_neuro_AF_fin_male=0.00000e+00;non_neuro_nhomalt_fin_male=0;AC_female=0;AN_female=5344;AF_female=0.00000e+00;nhomalt_female=0;non_neuro_AC_oth_male=0;non_neuro_AN_oth_male=156;non_neuro_AF_oth_male=0.00000e+00;non_neuro_nhomalt_oth_male=0;non_topmed_AC_nfe_est=0;non_topmed_AN_nfe_est=1574;non_topmed_AF_nfe_est=0.00000e+00;non_topmed_nhomalt_nfe_est=0;non_topmed_AC_nfe_nwe=0;non_topmed_AN_nfe_nwe=2040;non_topmed_AF_nfe_nwe=0.00000e+00;non_topmed_nhomalt_nfe_nwe=0;non_topmed_AC_amr_male=0;non_topmed_AN_amr_male=214;non_topmed_AF_amr_male=0.00000e+00;non_topmed_nhomalt_amr_male=0;non_topmed_AC_nfe_onf=0;non_topmed_AN_nfe_onf=764;non_topmed_AF_nfe_onf=0.00000e+00;non_topmed_nhomalt_nfe_onf=0;controls_AC_eas_male=0;controls_AN_eas_male=240;controls_AF_eas_male=0.00000e+00;controls_nhomalt_eas_male=0;controls_AC_oth_male=0;controls_AN_oth_male=90;controls_AF_oth_male=0.00000e+00;controls_nhomalt_oth_male=0;non_topmed_AC=0;non_topmed_AN=10704;non_topmed_AF=0.00000e+00;non_topmed_nhomalt=0;controls_AC_fin=0;controls_AN_fin=562;controls_AF_fin=0.00000e+00;controls_nhomalt_fin=0;non_neuro_AC_nfe=0;non_neuro_AN_nfe=4916;non_neuro_AF_nfe=0.00000e+00;non_neuro_nhomalt_nfe=0;non_neuro_AC_fin_female=0;non_neuro_AN_fin_female=266;non_neuro_AF_fin_female=0.00000e+00;non_neuro_nhomalt_fin_female=0;non_topmed_AC_nfe_seu=0;non_topmed_AN_nfe_seu=86;non_topmed_AF_nfe_seu=0.00000e+00;non_topmed_nhomalt_nfe_seu=0;controls_AC_eas_female=0;controls_AN_eas_female=126;controls_AF_eas_female=0.00000e+00;controls_nhomalt_eas_female=0;non_topmed_AC_asj=0;non_topmed_AN_asj=82;non_topmed_AF_asj=0.00000e+00;non_topmed_nhomalt_asj=0;controls_AC_nfe_onf=0;controls_AN_nfe_onf=242;controls_AF_nfe_onf=0.00000e+00;controls_nhomalt_nfe_onf=0;non_neuro_AC=0;non_neuro_AN=8006;non_neuro_AF=0.00000e+00;non_neuro_nhomalt=0;non_topmed_AC_nfe=0;non_topmed_AN_nfe=4464;non_topmed_AF_nfe=0.00000e+00;non_topmed_nhomalt_nfe=0;non_topmed_AC_raw=8;non_topmed_AN_raw=26394;non_topmed_AF_raw=3.03099e-04;non_topmed_nhomalt_raw=0;non_neuro_AC_nfe_est=0;non_neuro_AN_nfe_est=1408;non_neuro_AF_nfe_est=0.00000e+00;non_neuro_nhomalt_nfe_est=0;non_topmed_AC_oth_male=0;non_topmed_AN_oth_male=220;non_topmed_AF_oth_male=0.00000e+00;non_topmed_nhomalt_oth_male=0;AC_nfe_est=0;AN_nfe_est=1582;AF_nfe_est=0.00000e+00;nhomalt_nfe_est=0;non_topmed_AC_afr_male=0;non_topmed_AN_afr_male=1864;non_topmed_AF_afr_male=0.00000e+00;non_topmed_nhomalt_afr_male=0;AC_eas_male=0;AN_eas_male=428;AF_eas_male=0.00000e+00;nhomalt_eas_male=0;controls_AC_eas=0;controls_AN_eas=366;controls_AF_eas=0.00000e+00;controls_nhomalt_eas=0;non_neuro_AC_eas_male=0;non_neuro_AN_eas_male=428;non_neuro_AF_eas_male=0.00000e+00;non_neuro_nhomalt_eas_male=0;non_neuro_AC_asj_male=0;non_neuro_AN_asj_male=72;non_neuro_AF_asj_male=0.00000e+00;non_neuro_nhomalt_asj_male=0;controls_AC_oth=0;controls_AN_oth=192;controls_AF_oth=0.00000e+00;controls_nhomalt_oth=0;AC_nfe=0;AN_nfe=5930;AF_nfe=0.00000e+00;nhomalt_nfe=0;non_topmed_AC_female=0;non_topmed_AN_female=4886;non_topmed_AF_female=0.00000e+00;non_topmed_nhomalt_female=0;non_neuro_AC_asj=0;non_neuro_AN_asj=102;non_neuro_AF_asj=0.00000e+00;non_neuro_nhomalt_asj=0;non_topmed_AC_eas_female=0;non_topmed_AN_eas_female=194;non_topmed_AF_eas_female=0.00000e+00;non_topmed_nhomalt_eas_female=0;non_neuro_AC_raw=4;non_neuro_AN_raw=21158;non_neuro_AF_raw=1.89054e-04;non_neuro_nhomalt_raw=0;non_topmed_AC_eas=0;non_topmed_AN_eas=612;non_topmed_AF_eas=0.00000e+00;non_topmed_nhomalt_eas=0;non_topmed_AC_fin_male=0;non_topmed_AN_fin_male=730;non_topmed_AF_fin_male=0.00000e+00;non_topmed_nhomalt_fin_male=0;AC_fin=0;AN_fin=1566;AF_fin=0.00000e+00;nhomalt_fin=0;AC_nfe_male=0;AN_nfe_male=3404;AF_nfe_male=0.00000e+00;nhomalt_nfe_male=0;controls_AC_amr_male=0;controls_AN_amr_male=66;controls_AF_amr_male=0.00000e+00;controls_nhomalt_amr_male=0;controls_AC_afr_female=0;controls_AN_afr_female=420;controls_AF_afr_female=0.00000e+00;controls_nhomalt_afr_female=0;controls_AC_amr=0;controls_AN_amr=110;controls_AF_amr=0.00000e+00;controls_nhomalt_amr=0;AC_asj_female=0;AN_asj_female=48;AF_asj_female=0.00000e+00;nhomalt_asj_female=0;non_neuro_AC_eas=0;non_neuro_AN_eas=638;non_neuro_AF_eas=0.00000e+00;non_neuro_nhomalt_eas=0;non_neuro_AC_male=0;non_neuro_AN_male=4476;non_neuro_AF_male=0.00000e+00;non_neuro_nhomalt_male=0;AC_asj=0;AN_asj=138;AF_asj=0.00000e+00;nhomalt_asj=0;controls_AC_nfe_est=0;controls_AN_nfe_est=1390;controls_AF_nfe_est=0.00000e+00;controls_nhomalt_nfe_est=0;non_topmed_AC_asj_female=0;non_topmed_AN_asj_female=42;non_topmed_AF_asj_female=0.00000e+00;non_topmed_nhomalt_asj_female=0;non_topmed_AC_oth=0;non_topmed_AN_oth=450;non_topmed_AF_oth=0.00000e+00;non_topmed_nhomalt_oth=0;non_topmed_AC_fin_female=0;non_topmed_AN_fin_female=836;non_topmed_AF_fin_female=0.00000e+00;non_topmed_nhomalt_fin_female=0;AC_oth=0;AN_oth=474;AF_oth=0.00000e+00;nhomalt_oth=0;non_neuro_AC_nfe_male=0;non_neuro_AN_nfe_male=2792;non_neuro_AF_nfe_male=0.00000e+00;non_neuro_nhomalt_nfe_male=0;controls_AC_female=0;controls_AN_female=1932;controls_AF_female=0.00000e+00;controls_nhomalt_female=0;non_topmed_AC_fin=0;non_topmed_AN_fin=1566;non_topmed_AF_fin=0.00000e+00;non_topmed_nhomalt_fin=0;non_topmed_AC_nfe_female=0;non_topmed_AN_nfe_female=2132;non_topmed_AF_nfe_female=0.00000e+00;non_topmed_nhomalt_nfe_female=0;controls_AC_asj_male=0;controls_AN_asj_male=8;controls_AF_asj_male=0.00000e+00;controls_nhomalt_asj_male=0;non_topmed_AC_asj_male=0;non_topmed_AN_asj_male=40;non_topmed_AF_asj_male=0.00000e+00;non_topmed_nhomalt_asj_male=0;non_neuro_AC_oth=0;non_neuro_AN_oth=294;non_neuro_AF_oth=0.00000e+00;non_neuro_nhomalt_oth=0;AC_male=0;AN_male=7010;AF_male=0.00000e+00;nhomalt_male=0;controls_AC_fin_female=0;controls_AN_fin_female=266;controls_AF_fin_female=0.00000e+00;controls_nhomalt_fin_female=0;controls_AC_asj_female=0;controls_AN_asj_female=18;controls_AF_asj_female=0.00000e+00;controls_nhomalt_asj_female=0;AC_amr_male=0;AN_amr_male=222;AF_amr_male=0.00000e+00;nhomalt_amr_male=0;AC_amr_female=0;AN_amr_female=164;AF_amr_female=0.00000e+00;nhomalt_amr_female=0;AC_oth_male=0;AN_oth_male=240;AF_oth_male=0.00000e+00;nhomalt_oth_male=0;non_neuro_AC_nfe_seu=0;non_neuro_AN_nfe_seu=46;non_neuro_AF_nfe_seu=0.00000e+00;non_neuro_nhomalt_nfe_seu=0;non_topmed_AC_afr_female=0;non_topmed_AN_afr_female=1296;non_topmed_AF_afr_female=0.00000e+00;non_topmed_nhomalt_afr_female=0;non_topmed_AC_afr=0;non_topmed_AN_afr=3160;non_topmed_AF_afr=0.00000e+00;non_topmed_nhomalt_afr=0;controls_AC=0;controls_AN=4336;controls_AF=0.00000e+00;controls_nhomalt=0;non_neuro_AC_oth_female=0;non_neuro_AN_oth_female=138;non_neuro_AF_oth_female=0.00000e+00;non_neuro_nhomalt_oth_female=0;non_topmed_faf95_amr=0.00000e+00;non_topmed_faf99_amr=0.00000e+00;faf95_afr=0.00000e+00;faf99_afr=0.00000e+00;controls_faf95_afr=0.00000e+00;controls_faf99_afr=0.00000e+00;faf95_amr=0.00000e+00;faf99_amr=0.00000e+00;faf95_eas=0.00000e+00;faf99_eas=0.00000e+00;faf95=0.00000e+00;faf99=0.00000e+00;non_neuro_faf95_afr=0.00000e+00;non_neuro_faf99_afr=0.00000e+00;non_neuro_faf95_amr=0.00000e+00;non_neuro_faf99_amr=0.00000e+00;controls_faf95_nfe=0.00000e+00;controls_faf99_nfe=0.00000e+00;non_topmed_faf95=0.00000e+00;non_topmed_faf99=0.00000e+00;non_neuro_faf95_nfe=0.00000e+00;non_neuro_faf99_nfe=0.00000e+00;non_neuro_faf95=0.00000e+00;non_neuro_faf99=0.00000e+00;non_topmed_faf95_nfe=0.00000e+00;non_topmed_faf99_nfe=0.00000e+00;controls_faf95_eas=0.00000e+00;controls_faf99_eas=0.00000e+00;faf95_nfe=0.00000e+00;faf99_nfe=0.00000e+00;non_topmed_faf95_eas=0.00000e+00;non_topmed_faf99_eas=0.00000e+00;controls_faf95_amr=0.00000e+00;controls_faf99_amr=0.00000e+00;non_neuro_faf95_eas=0.00000e+00;non_neuro_faf99_eas=0.00000e+00;non_topmed_faf95_afr=0.00000e+00;non_topmed_faf99_afr=0.00000e+00;controls_faf95=0.00000e+00;controls_faf99=0.00000e+00;age_hist_het_bin_freq=0|0|0|0|0|0|0|0|0|0;age_hist_het_n_smaller=0;age_hist_het_n_larger=0;age_hist_hom_bin_freq=0|0|0|0|0|0|0|0|0|0;age_hist_hom_n_smaller=0;age_hist_hom_n_larger=0;vep=C|downstream_gene_variant|MODIFIER|WASH7P|ENSG00000227232|Transcript|ENST00000423562|unprocessed_pseudogene|||||||||||1|4243|-1||SNV|1|HGNC|38034||||||||||||||||||||||||||||||||||||||||||,C|downstream_gene_variant|MODIFIER|WASH7P|ENSG00000227232|Transcript|ENST00000438504|unprocessed_pseudogene|||||||||||1|4243|-1||SNV|1|HGNC|38034|YES|||||||||||||||||||||||||||||||||||||||||,C|upstream_gene_variant|MODIFIER|DDX11L1|ENSG00000223972|Transcript|ENST00000450305|transcribed_unprocessed_pseudogene|||||||||||1|1890|1||SNV|1|HGNC|37102||||||||||||||||||||||||||||||||||||||||||,C|upstream_gene_variant|MODIFIER|DDX11L1|ENSG00000223972|Transcript|ENST00000456328|processed_transcript|||||||||||1|1749|1||SNV|1|HGNC|37102|YES|||||||||||||||||||||||||||||||||||||||||,C|downstream_gene_variant|MODIFIER|WASH7P|ENSG00000227232|Transcript|ENST00000488147|unprocessed_pseudogene|||||||||||1|4284|-1||SNV|1|HGNC|38034||||||||||||||||||||||||||||||||||||||||||,C|upstream_gene_variant|MODIFIER|DDX11L1|ENSG00000223972|Transcript|ENST00000515242|transcribed_unprocessed_pseudogene|||||||||||1|1752|1||SNV|1|HGNC|37102||||||||||||||||||||||||||||||||||||||||||,C|upstream_gene_variant|MODIFIER|DDX11L1|ENSG00000223972|Transcript|ENST00000518655|transcribed_unprocessed_pseudogene|||||||||||1|1754|1||SNV|1|HGNC|37102||||||||||||||||||||||||||||||||||||||||||,C|downstream_gene_variant|MODIFIER|WASH7P|ENSG00000227232|Transcript|ENST00000538476|unprocessed_pseudogene|||||||||||1|4291|-1||SNV|1|HGNC|38034||||||||||||||||||||||||||||||||||||||||||,C|downstream_gene_variant|MODIFIER|WASH7P|ENSG00000227232|Transcript|ENST00000541675|unprocessed_pseudogene|||||||||||1|4243|-1||SNV|1|HGNC|38034||||||||||||||||||||||||||||||||||||||||||,C|regulatory_region_variant|MODIFIER|||RegulatoryFeature|ENSR00001576074|CTCF_binding_site|||||||||||1||||SNV|1||||||||||||||||||||||||||||||||||||||||||||");

            writer.Flush();

            stream.Position = 0;
            return stream;
        }

        
        [Fact]
        public void GetItems_test()
        {
            var sequence = new SimpleSequence(new string('A', VariantUtils.MaxUpstreamLength) + "TGTGTTGTTATTCTGTGTGCAT", 10114 - VariantUtils.MaxUpstreamLength);

            var refNameToChrom = new Dictionary<string, IChromosome> { { "1", Chrom1 } };

            var sequenceProvider = new SimpleSequenceProvider(GenomeAssembly.GRCh38, sequence, refNameToChrom);

            var gnomadReader = new GnomadReader(new StreamReader(GetGnomadStream()), sequenceProvider);

            var items = gnomadReader.GetItems().ToList();

            Assert.Equal(2, items.Count);
            Assert.Equal("\"coverage\":218,\"failedFilter\":true,\"allAf\":0,\"allAn\":8734,\"allAc\":0,\"allHc\":0,\"afrAf\":0,\"afrAn\":2168,\"afrAc\":0,\"afrHc\":0,\"amrAf\":0,\"amrAn\":324,\"amrAc\":0,\"amrHc\":0,\"easAf\":0,\"easAn\":438,\"easAc\":0,\"easHc\":0,\"finAf\":0,\"finAn\":1296,\"finAc\":0,\"finHc\":0,\"nfeAf\":0,\"nfeAn\":4054,\"nfeAc\":0,\"nfeHc\":0,\"asjAf\":0,\"asjAn\":100,\"asjAc\":0,\"asjHc\":0,\"othAf\":0,\"othAn\":354,\"othAc\":0,\"othHc\":0", items[0].GetJsonString());
        }

        private static Stream GetConflictingItemsStream()
        {
            var stream = new MemoryStream();
            var writer = new StreamWriter(stream);

            writer.WriteLine("##gnomAD");
            writer.WriteLine("#CHROM\tPOS\tID\tREF\tALT\tQUAL\tFILTER\tINFO");
            writer.WriteLine("22\t16558315\trs369787349\tT\tC,G,T,ACTGGCTGCCTGGCTTG\t818363\tAC0;LCR;RF;SEGDUP\tAC=87,7,0,2;AF=5.30488e-01,4.26829e-02,0.00000e+00,1.21951e-02;AN=164;AC_AFR=31,1,0,2;AC_AMR=3,0,0,0;AC_ASJ=0,0,0,0;AC_EAS=4,0,0,0;AC_FIN=33,5,0,0;AC_NFE=13,1,0,0;AC_OTH=3,0,0,0;AC_Male=40,1,0,0;AC_Female=47,6,0,2;AN_AFR=56;AN_AMR=4;AN_ASJ=0;AN_EAS=6;AN_FIN=64;AN_NFE=28;AN_OTH=6;AN_Male=78;AN_Female=86;AF_AFR=5.53571e-01,1.78571e-02,0.00000e+00,3.57143e-02;AF_AMR=7.50000e-01,0.00000e+00,0.00000e+00,0.00000e+00;AF_ASJ=.,.,.,.;AF_EAS=6.66667e-01,0.00000e+00,0.00000e+00,0.00000e+00;AF_FIN=5.15625e-01,7.81250e-02,0.00000e+00,0.00000e+00;AF_NFE=4.64286e-01,3.57143e-02,0.00000e+00,0.00000e+00;AF_OTH=5.00000e-01,0.00000e+00,0.00000e+00,0.00000e+00;AF_Male=5.12821e-01,1.28205e-02,0.00000e+00,0.00000e+00;AF_Female=5.46512e-01,6.97674e-02,0.00000e+00,2.32558e-02;GC_AFR=3,16,7,0,1,0,0,0,0,0,0,0,0,0,1;GC_AMR=0,1,1,0,0,0,0,0,0,0,0,0,0,0,0;GC_ASJ=0,0,0,0,0,0,0,0,0,0,0,0,0,0,0;GC_EAS=0,2,1,0,0,0,0,0,0,0,0,0,0,0,0;GC_FIN=2,18,6,0,3,1,0,0,0,0,0,0,0,0,0;GC_NFE=3,8,2,0,1,0,0,0,0,0,0,0,0,0,0;GC_OTH=1,1,1,0,0,0,0,0,0,0,0,0,0,0,0;GC_Male=6,23,8,0,1,0,0,0,0,0,0,0,0,0,0;GC_Female=3,23,10,0,4,1,0,0,0,0,0,0,0,0,1;AC_raw=7179,402,23,4;AN_raw=13956;AF_raw=5.14402e-01,2.88048e-02,1.64804e-03,2.86615e-04;GC_raw=2158,1885,2598,68,90,122,3,8,0,6,0,0,0,0,2;GC=9,46,18,0,5,1,0,0,0,0,0,0,0,0,1;AC_POPMAX=3,5,.,2;AN_POPMAX=4,64,.,56;AF_POPMAX=7.50000e-01,7.81250e-02,.,3.57143e-02");
            writer.WriteLine("22\t16558315\trs376808508\tTAAGCCAGCCAGCCAGCCAAGCTGGCCAAGCCAGACAGGCAGCCAAGCCAACCAAGACACCCAGGCAGCCAAGCCAGC\tCAAGCCAGCCAGCCAGCCAAGCTGGCCAAGCCAGACAGGCAGCCAAGCCAACCAAGACACCCAGGCAGCCAAGCCAGC,T\t3.62825e+06\tLCR;RF;SEGDUP\tAC=155,1;AF=9.63451e-03,6.21581e-05;AN=16088;AC_AFR=46,1;AC_AMR=6,0;AC_ASJ=1,0;AC_EAS=3,0;AC_FIN=27,0;AC_NFE=67,0;AC_OTH=5,0;AC_Male=83,1;AC_Female=72,0;AN_AFR=3744;AN_AMR=534;AN_ASJ=186;AN_EAS=986;AN_FIN=1770;AN_NFE=8370;AN_OTH=498;AN_Male=8994;AN_Female=7094;AF_AFR=1.22863e-02,2.67094e-04;AF_AMR=1.12360e-02,0.00000e+00;AF_ASJ=5.37634e-03,0.00000e+00;AF_EAS=3.04260e-03,0.00000e+00;AF_FIN=1.52542e-02,0.00000e+00;AF_NFE=8.00478e-03,0.00000e+00;AF_OTH=1.00402e-02,0.00000e+00;AF_Male=9.22837e-03,1.11185e-04;AF_Female=1.01494e-02,0.00000e+00;GC_AFR=602,46,0,1,0,0;GC_AMR=64,6,0,0,0,0;GC_ASJ=20,1,0,0,0,0;GC_EAS=204,3,0,0,0,0;GC_FIN=255,23,2,0,0,0;GC_NFE=1083,51,8,0,0,0;GC_OTH=59,5,0,0,0,0;GC_Male=1304,71,6,1,0,0;GC_Female=983,64,4,0,0,0;AC_raw=413,1;AN_raw=28686;AF_raw=1.43973e-02,3.48602e-05;GC_raw=7802,349,30,1,0,0;GC=2287,135,10,1,0,0;AC_POPMAX=27,1;AN_POPMAX=1770,3744;AF_POPMAX=1.52542e-02,2.67094e-04");

            writer.Flush();

            stream.Position = 0;
            return stream;
        }

        [Fact]
        public void IdentifyConflictingItems()
        {
            var sequence = new SimpleSequence(new string('A', VariantUtils.MaxUpstreamLength) + "TAAGCCAGCCAGCCAGCCAAGCTGGCCAAGCCAGACAGGCAGCCAAGCCAACCAAGACACCCAGGCAGCCAAGCCAGC", 16558315 - VariantUtils.MaxUpstreamLength);

            var refNameToChrom = new Dictionary<string, IChromosome> { { "22", Chrom22 } };

            var sequenceProvider = new SimpleSequenceProvider(GenomeAssembly.GRCh38, sequence, refNameToChrom);

            var gnomadReader = new GnomadReader(new StreamReader(GetConflictingItemsStream()), sequenceProvider);

            var items = new List<ISupplementaryDataItem>();
            foreach (GnomadItem item in gnomadReader.GetItems())
            {
                //item.Trim();
                if (item.Position== 16558315)
                    items.Add(item);
            }

            items = SuppDataUtilities.RemoveConflictingAlleles(items, false);

            //two if the items were removed as conflicting items
            Assert.Equal(3,items.Count);
        }

        private static Stream GetShiftingItemsStream()
        {
            var stream = new MemoryStream();
            var writer = new StreamWriter(stream);

            writer.WriteLine("##gnomAD");
            writer.WriteLine("#CHROM\tPOS\tID\tREF\tALT\tQUAL\tFILTER\tINFO");
            writer.WriteLine("6\t157100396\trs572236007\tGCGC\tGCGCCGC,G,GCGCCGCCGC\t584951.32\tPASS\tAC=1218,2,16;AF=5.55505e-02,9.12159e-05,7.29727e-04;AN=21926;BaseQRankSum=-1.09000e-01;ClippingRankSum=0.00000e+00;DP=300864;FS=0.00000e+00;InbreedingCoeff=1.17500e-01;MQ=6.00000e+01;MQRankSum=5.00000e-02;QD=2.04400e+01;ReadPosRankSum=-3.20000e-02;SOR=6.96000e-01;VQSLOD=1.36000e+00;VQSR_culprit=FS;GQ_HIST_ALT=2|51|6|22|28|15|24|50|9|10|13|14|14|30|30|40|21|2|7|1303,0|0|0|0|0|0|0|1|0|0|2|0|2|0|1|1|0|0|0|0,0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|1|0|0|0|18;DP_HIST_ALT=118|405|463|353|224|88|27|9|4|0|0|0|0|0|0|0|0|0|0|0,1|3|3|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0|0,0|3|3|5|4|3|0|1|0|0|0|0|0|0|0|0|0|0|0|0;AB_HIST_ALT=0|0|2|2|15|66|110|105|196|124|306|173|171|111|49|51|27|13|4|0,0|0|0|1|3|0|1|0|1|0|0|0|0|1|0|0|0|0|0|0,0|0|0|0|0|0|1|0|2|3|3|3|5|2|0|0|0|0|0|0;GQ_HIST_ALL=884|807|422|735|789|518|941|1060|612|1106|1091|578|1371|377|750|327|591|92|328|1739;DP_HIST_ALL=1331|2305|2891|3184|2842|1490|781|244|45|4|1|0|0|0|0|0|0|0|0|0;AB_HIST_ALL=0|0|2|3|18|66|112|105|199|127|309|175|176|115|49|51|27|13|4|0;AC_Male=661,1,6;AC_Female=557,1,10;AN_Male=12450;AN_Female=9476;AF_Male=5.30924e-02,8.03213e-05,4.81928e-04;AF_Female=5.87801e-02,1.05530e-04,1.05530e-03;GC_Male=5587,601,30,1,0,0,6,0,0,0;GC_Female=4205,487,35,1,0,0,10,0,0,0;GC_raw=13401,1525,166,7,0,0,19,0,0,0;AC_raw=1857,7,19;AN_raw=30236;GC=9792,1088,65,2,0,0,16,0,0,0;AF_raw=6.14169e-02,2.31512e-04,6.28390e-04;Hom_AFR=0,0,0;Hom_AMR=1,0,0;Hom_ASJ=0,0,0;Hom_EAS=0,0,0;Hom_FIN=5,0,0;Hom_NFE=56,0,0;Hom_OTH=3,0,0;Hom=65,0,0;Hom_raw=166,0,0;AC_AFR=123,0,15;AC_AMR=8,0,0;AC_ASJ=6,0,0;AC_EAS=0,0,0;AC_FIN=69,0,0;AC_NFE=979,2,1;AC_OTH=33,0,0;AN_AFR=7512;AN_AMR=376;AN_ASJ=206;AN_EAS=1556;AN_FIN=694;AN_NFE=11022;AN_OTH=560;AF_AFR=1.63738e-02,0.00000e+00,1.99681e-03;AF_AMR=2.12766e-02,0.00000e+00,0.00000e+00;AF_ASJ=2.91262e-02,0.00000e+00,0.00000e+00;AF_EAS=0.00000e+00,0.00000e+00,0.00000e+00;AF_FIN=9.94236e-02,0.00000e+00,0.00000e+00;AF_NFE=8.88224e-02,1.81455e-04,9.07276e-05;AF_OTH=5.89286e-02,0.00000e+00,0.00000e+00;POPMAX=FIN,NFE,AFR;AC_POPMAX=69,2,15;AN_POPMAX=694,11022,7512;AF_POPMAX=9.94236e-02,1.81455e-04,1.99681e-03;DP_MEDIAN=13,7,17;DREF_MEDIAN=1.00000e-25,5.31547e-07,3.16228e-39;GQ_MEDIAN=99,60,99;AB_MEDIAN=5.00000e-01,2.77778e-01,5.71429e-01;AS_RF=7.69554e-01,3.84245e-02,8.79158e-01;AS_FilterStatus=PASS,RF,PASS;CSQ=CGCCGC|inframe_insertion|MODERATE|ARID1B|ENSG00000049618|Transcript|ENST00000275248|protein_coding|1/20||ENST00000275248.4:c.1171_1176dupCCGCCG|ENSP00000275248.4:p.Pro391_Pro392dup|1314-1315|1162-1163|388|P/PPP|ccg/cCGCCGCcg|rs766249098|3||1||insertion|1|HGNC|18040|||||ENSP00000275248||G3XAA0|UPI0000231CAD|1|||Low_complexity_(Seg):seg&hmmpanther:PTHR12656&hmmpanther:PTHR12656:SF11|14|||||||||||||||||||||||||||||,CGCCGC|inframe_insertion|MODERATE|ARID1B|ENSG00000049618|Transcript|ENST00000346085|protein_coding|1/20||ENST00000346085.5:c.1345_1350dupCCGCCG|ENSP00000344546.4:p.Pro449_Pro450dup|1337-1338|1336-1337|446|P/PPP|ccg/cCGCCGCcg|rs766249098|3||1||insertion|1|HGNC|18040|YES|||CCDS55072.1|ENSP00000344546|Q8NFD5||UPI000058E4B2|1|||Low_complexity_(Seg):seg&hmmpanther:PTHR12656:SF11&hmmpanther:PTHR12656|14|||||||||||||||||||||||||||||,CGCCGC|inframe_insertion|MODERATE|ARID1B|ENSG00000049618|Transcript|ENST00000350026|protein_coding|1/19||ENST00000350026.5:c.1345_1350dupCCGCCG|ENSP00000055163.7:p.Pro449_Pro450dup|1337-1338|1336-1337|446|P/PPP|ccg/cCGCCGCcg|rs766249098|3||1||insertion|1|HGNC|18040||||CCDS5251.2|ENSP00000055163|Q8NFD5||UPI000058E2EA|1|||Low_complexity_(Seg):seg&hmmpanther:PTHR12656&hmmpanther:PTHR12656:SF11|14|||||||||||||||||||||||||||||,CGCCGC|inframe_insertion|MODERATE|ARID1B|ENSG00000049618|Transcript|ENST00000367148|protein_coding|1/20||ENST00000367148.1:c.1345_1350dupCCGCCG|ENSP00000356116.1:p.Pro449_Pro450dup|1336-1337|1336-1337|446|P/PPP|ccg/cCGCCGCcg|rs766249098|3||1||insertion|1|HGNC|18040|||||ENSP00000356116|Q8NFD5|G3XAA0|UPI000058E4B3|1|||Low_complexity_(Seg):seg&hmmpanther:PTHR12656:SF11&hmmpanther:PTHR12656|14|||||||||||||||||||||||||||||,CGCCGC|upstream_gene_variant|MODIFIER|ARID1B|ENSG00000049618|Transcript|ENST00000414678|protein_coding||||||||||rs766249098|3|167|1|cds_start_NF|insertion|1|HGNC|18040|||||ENSP00000412835||H0Y7H8|UPI0001D3BCFD|1|||||||||||||||||||||||||||||||||,CGCCGC|upstream_gene_variant|MODIFIER|RP11-230C9.2|ENSG00000271551|Transcript|ENST00000603191|lincRNA||||||||||rs766249098|3|2188|-1||insertion|1|Clone_based_vega_gene||YES|||||||||||||||||||||||||||||||||||||||||,CGCCGC|upstream_gene_variant|MODIFIER|RP11-230C9.4|ENSG00000271265|Transcript|ENST00000604082|lincRNA||||||||||rs766249098|3|4603|-1||insertion|1|Clone_based_vega_gene||YES|||||||||||||||||||||||||||||||||||||||||,CGCCGC|downstream_gene_variant|MODIFIER|RP11-230C9.3|ENSG00000270487|Transcript|ENST00000604792|antisense||||||||||rs766249098|3|1061|-1||insertion|1|Clone_based_vega_gene||YES|||||||||||||||||||||||||||||||||||||||||,CGCCGC|downstream_gene_variant|MODIFIER|MIR4466|ENSG00000271899|Transcript|ENST00000606121|miRNA||||||||||rs766249098|3|412|-1||insertion|1|HGNC|41726|YES|||||||||||||||||||||||||||||||||||||||||,-|inframe_deletion|MODERATE|ARID1B|ENSG00000049618|Transcript|ENST00000275248|protein_coding|1/20||ENST00000275248.4:c.1174_1176delCCG|ENSP00000275248.4:p.Pro392del|1312-1314|1160-1162|387-388|AP/A|gCGCcg/gcg|rs766249098|2||1||insertion|1|HGNC|18040|||||ENSP00000275248||G3XAA0|UPI0000231CAD|1|||Low_complexity_(Seg):seg&hmmpanther:PTHR12656&hmmpanther:PTHR12656:SF11|14|||||||||||||||||||||||||||||,-|inframe_deletion|MODERATE|ARID1B|ENSG00000049618|Transcript|ENST00000346085|protein_coding|1/20||ENST00000346085.5:c.1348_1350delCCG|ENSP00000344546.4:p.Pro450del|1335-1337|1334-1336|445-446|AP/A|gCGCcg/gcg|rs766249098|2||1||insertion|1|HGNC|18040|YES|||CCDS55072.1|ENSP00000344546|Q8NFD5||UPI000058E4B2|1|||Low_complexity_(Seg):seg&hmmpanther:PTHR12656:SF11&hmmpanther:PTHR12656|14|||||||||||||||||||||||||||||,-|inframe_deletion|MODERATE|ARID1B|ENSG00000049618|Transcript|ENST00000350026|protein_coding|1/19||ENST00000350026.5:c.1348_1350delCCG|ENSP00000055163.7:p.Pro450del|1335-1337|1334-1336|445-446|AP/A|gCGCcg/gcg|rs766249098|2||1||insertion|1|HGNC|18040||||CCDS5251.2|ENSP00000055163|Q8NFD5||UPI000058E2EA|1|||Low_complexity_(Seg):seg&hmmpanther:PTHR12656&hmmpanther:PTHR12656:SF11|14|||||||||||||||||||||||||||||,-|inframe_deletion|MODERATE|ARID1B|ENSG00000049618|Transcript|ENST00000367148|protein_coding|1/20||ENST00000367148.1:c.1348_1350delCCG|ENSP00000356116.1:p.Pro450del|1334-1336|1334-1336|445-446|AP/A|gCGCcg/gcg|rs766249098|2||1||insertion|1|HGNC|18040|||||ENSP00000356116|Q8NFD5|G3XAA0|UPI000058E4B3|1|||Low_complexity_(Seg):seg&hmmpanther:PTHR12656:SF11&hmmpanther:PTHR12656|14|||||||||||||||||||||||||||||,-|upstream_gene_variant|MODIFIER|ARID1B|ENSG00000049618|Transcript|ENST00000414678|protein_coding||||||||||rs766249098|2|168|1|cds_start_NF|insertion|1|HGNC|18040|||||ENSP00000412835||H0Y7H8|UPI0001D3BCFD|1|||||||||||||||||||||||||||||||||,-|upstream_gene_variant|MODIFIER|RP11-230C9.2|ENSG00000271551|Transcript|ENST00000603191|lincRNA||||||||||rs766249098|2|2186|-1||insertion|1|Clone_based_vega_gene||YES|||||||||||||||||||||||||||||||||||||||||,-|upstream_gene_variant|MODIFIER|RP11-230C9.4|ENSG00000271265|Transcript|ENST00000604082|lincRNA||||||||||rs766249098|2|4601|-1||insertion|1|Clone_based_vega_gene||YES|||||||||||||||||||||||||||||||||||||||||,-|downstream_gene_variant|MODIFIER|RP11-230C9.3|ENSG00000270487|Transcript|ENST00000604792|antisense||||||||||rs766249098|2|1062|-1||insertion|1|Clone_based_vega_gene||YES|||||||||||||||||||||||||||||||||||||||||,-|downstream_gene_variant|MODIFIER|MIR4466|ENSG00000271899|Transcript|ENST00000606121|miRNA||||||||||rs766249098|2|413|-1||insertion|1|HGNC|41726|YES|||||||||||||||||||||||||||||||||||||||||,CGC|inframe_insertion|MODERATE|ARID1B|ENSG00000049618|Transcript|ENST00000275248|protein_coding|1/20||ENST00000275248.4:c.1174_1176dupCCG|ENSP00000275248.4:p.Pro392dup|1314-1315|1162-1163|388|P/PP|ccg/cCGCcg|rs766249098|1||1||insertion|1|HGNC|18040|||||ENSP00000275248||G3XAA0|UPI0000231CAD|1|||Low_complexity_(Seg):seg&hmmpanther:PTHR12656&hmmpanther:PTHR12656:SF11|14|||||||||||||||||||||||||||||,CGC|inframe_insertion|MODERATE|ARID1B|ENSG00000049618|Transcript|ENST00000346085|protein_coding|1/20||ENST00000346085.5:c.1348_1350dupCCG|ENSP00000344546.4:p.Pro450dup|1337-1338|1336-1337|446|P/PP|ccg/cCGCcg|rs766249098|1||1||insertion|1|HGNC|18040|YES|||CCDS55072.1|ENSP00000344546|Q8NFD5||UPI000058E4B2|1|||Low_complexity_(Seg):seg&hmmpanther:PTHR12656:SF11&hmmpanther:PTHR12656|14|||||||||||||||||||||||||||||,CGC|inframe_insertion|MODERATE|ARID1B|ENSG00000049618|Transcript|ENST00000350026|protein_coding|1/19||ENST00000350026.5:c.1348_1350dupCCG|ENSP00000055163.7:p.Pro450dup|1337-1338|1336-1337|446|P/PP|ccg/cCGCcg|rs766249098|1||1||insertion|1|HGNC|18040||||CCDS5251.2|ENSP00000055163|Q8NFD5||UPI000058E2EA|1|||Low_complexity_(Seg):seg&hmmpanther:PTHR12656&hmmpanther:PTHR12656:SF11|14|||||||||||||||||||||||||||||,CGC|inframe_insertion|MODERATE|ARID1B|ENSG00000049618|Transcript|ENST00000367148|protein_coding|1/20||ENST00000367148.1:c.1348_1350dupCCG|ENSP00000356116.1:p.Pro450dup|1336-1337|1336-1337|446|P/PP|ccg/cCGCcg|rs766249098|1||1||insertion|1|HGNC|18040|||||ENSP00000356116|Q8NFD5|G3XAA0|UPI000058E4B3|1|||Low_complexity_(Seg):seg&hmmpanther:PTHR12656:SF11&hmmpanther:PTHR12656|14|||||||||||||||||||||||||||||,CGC|upstream_gene_variant|MODIFIER|ARID1B|ENSG00000049618|Transcript|ENST00000414678|protein_coding||||||||||rs766249098|1|167|1|cds_start_NF|insertion|1|HGNC|18040|||||ENSP00000412835||H0Y7H8|UPI0001D3BCFD|1|||||||||||||||||||||||||||||||||,CGC|upstream_gene_variant|MODIFIER|RP11-230C9.2|ENSG00000271551|Transcript|ENST00000603191|lincRNA||||||||||rs766249098|1|2188|-1||insertion|1|Clone_based_vega_gene||YES|||||||||||||||||||||||||||||||||||||||||,CGC|upstream_gene_variant|MODIFIER|RP11-230C9.4|ENSG00000271265|Transcript|ENST00000604082|lincRNA||||||||||rs766249098|1|4603|-1||insertion|1|Clone_based_vega_gene||YES|||||||||||||||||||||||||||||||||||||||||,CGC|downstream_gene_variant|MODIFIER|RP11-230C9.3|ENSG00000270487|Transcript|ENST00000604792|antisense||||||||||rs766249098|1|1061|-1||insertion|1|Clone_based_vega_gene||YES|||||||||||||||||||||||||||||||||||||||||,CGC|downstream_gene_variant|MODIFIER|MIR4466|ENSG00000271899|Transcript|ENST00000606121|miRNA||||||||||rs766249098|1|412|-1||insertion|1|HGNC|41726|YES|||||||||||||||||||||||||||||||||||||||||,CGCCGC|regulatory_region_variant|MODIFIER|||RegulatoryFeature|ENSR00001231649|promoter||||||||||rs766249098|3||||insertion|1||||||||||||||||||||||||||||||||||||||||||||,-|regulatory_region_variant|MODIFIER|||RegulatoryFeature|ENSR00001231649|promoter||||||||||rs766249098|2||||insertion|1||||||||||||||||||||||||||||||||||||||||||||,CGC|regulatory_region_variant|MODIFIER|||RegulatoryFeature|ENSR00001231649|promoter||||||||||rs766249098|1||||insertion|1||||||||||||||||||||||||||||||||||||||||||||,CGCCGC|TF_binding_site_variant|MODIFIER|||MotifFeature|MA0162.2|||||||||||rs766249098|3||1||insertion|1|||||||||||||||||||||||||||||||||||||Egr1:MA0162.2|5|N|||||,CGCCGC|TF_binding_site_variant|MODIFIER|||MotifFeature|MA0162.2|||||||||||rs766249098|3||1||insertion|1|||||||||||||||||||||||||||||||||||||Egr1:MA0162.2|2|N|||||,CGC|TF_binding_site_variant|MODIFIER|||MotifFeature|MA0162.2|||||||||||rs766249098|1||1||insertion|1|||||||||||||||||||||||||||||||||||||Egr1:MA0162.2|5|N|||||,CGC|TF_binding_site_variant|MODIFIER|||MotifFeature|MA0162.2|||||||||||rs766249098|1||1||insertion|1|||||||||||||||||||||||||||||||||||||Egr1:MA0162.2|2|N|||||,-|TF_binding_site_variant|MODIFIER|||MotifFeature|MA0162.2|||||||||||rs766249098|2||1||insertion|1|||||||||||||||||||||||||||||||||||||Egr1:MA0162.2|2|N|||||,-|TF_binding_site_variant|MODIFIER|||MotifFeature|MA0162.2|||||||||||rs766249098|2||1||insertion|1|||||||||||||||||||||||||||||||||||||Egr1:MA0162.2|-1|N|||||;GC_AFR=3618,123,0,0,0,0,15,0,0,0;GC_AMR=181,6,1,0,0,0,0,0,0,0;GC_ASJ=97,6,0,0,0,0,0,0,0,0;GC_EAS=778,0,0,0,0,0,0,0,0,0;GC_FIN=283,59,5,0,0,0,0,0,0,0;GC_NFE=4585,867,56,2,0,0,1,0,0,0;GC_OTH=250,27,3,0,0,0,0,0,0,0;Hom_Male=30,0,0;Hom_Female=35,0,0\n");

            writer.Flush();

            stream.Position = 0;
            return stream;
        }

        [Fact]
        public void LeftShiftingItems()
        {
            var sequence = new SimpleSequence(new string('A', VariantUtils.MaxUpstreamLength) + "GCGCGC", 157100394 -1 - VariantUtils.MaxUpstreamLength);

            var refNameToChrom = new Dictionary<string, IChromosome> { { "6", new Chromosome("chr6","6",6)} };

            var sequenceProvider = new SimpleSequenceProvider(GenomeAssembly.GRCh38, sequence, refNameToChrom);

            var gnomadReader = new GnomadReader(new StreamReader(GetShiftingItemsStream()), sequenceProvider);

            var items = gnomadReader.GetItems().ToList();
            Assert.Equal(3, items.Count);
            Assert.Equal(157100397, items[0].Position);
            Assert.Equal(157100397, items[1].Position);
            Assert.Equal(157100397, items[2].Position);
        }
    }
}